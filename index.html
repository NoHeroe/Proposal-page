<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"
  />
  <title>Pedido de Casamento</title>
  <style>
    /* mobile-only */
    @media (min-width: 600px) { body { display: none; } }

    /* reset */
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body {
      width:100vw; height:100vh;
      overflow:hidden;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
      background:#000 url('assets/bg-fixed.jpg') center/cover fixed no-repeat;
      color:#fff;
    }

    :root{
      --glass: rgba(255,255,255,0.1);
      --blur: 8px;
      --brand1:#6b21a8; --brand2:#9333ea;
      --panel-w: 90%; --panel-max: 360px;
      --btn-shadow: 0 4px 14px rgba(147,51,234,0.4);
      --btn-shadow-hover: 0 6px 20px rgba(147,51,234,0.5);
      --ease: cubic-bezier(.22,.61,.36,1);
    }

    /* container scroll-snap */
    #container {
      height:100%;
      overflow-y:auto;
      scroll-snap-type: y mandatory;
      scroll-behavior: smooth;
      position: relative;
      z-index: 0;
      -webkit-overflow-scrolling: touch;
    }

    /* glass panels */
    .panel {
      background: var(--glass);
      -webkit-backdrop-filter: blur(var(--blur));
      backdrop-filter: blur(var(--blur));
      width: var(--panel-w);
      max-width: var(--panel-max);
      padding: 16px 20px;
      border-radius:12px;
      margin:0 auto;
      text-align:center;
      z-index:10;
      will-change: transform, opacity;
      transform: translateY(14px);
      opacity: 0;
      transition: transform .6s var(--ease), opacity .6s var(--ease);
    }
    .panel.in {
      transform: translateY(0);
      opacity: 1;
    }

    /* sections */
    section.snap {
      position:relative;
      height:100vh;
      scroll-snap-align:start;
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
      padding: 16px;
    }

    /* fixed branches (parallax) */
    img.branch {
      position:fixed;
      z-index:20;
      pointer-events:none;
      width:200px;
      transform: translateZ(0);
      will-change: transform;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.35));
    }
    img.branch.left  { top:0; left:0; }
    img.branch.right { bottom:0; right:0; }

    /* petals layers (background animation existente preservada) */
    .petal-bg,
    .petal-fg {
      position:fixed; inset:0;
      pointer-events:none;
    }
    .petal { position:absolute; opacity:.85; will-change: transform, opacity; }

    @keyframes fall {
      0%   { transform: translateY(-20vh) rotate(0deg); opacity:1; }
      100% { transform: translateY(120vh) rotate(360deg); opacity:0; }
    }
    @keyframes rise {
      0%   { transform: translateY(0) rotate(0deg); opacity:1; }
      100% { transform: translateY(-50vh) rotate(360deg); opacity:1; }
    }

    /* buttons */
    .btn {
      position: relative;
      overflow: hidden;
      background:linear-gradient(135deg,var(--brand1) 0%,var(--brand2) 100%);
      border:none;
      box-shadow: var(--btn-shadow);
      color:#fff;
      font-weight:700;
      padding:12px 24px;
      border-radius:24px;
      cursor:pointer;
      transition:transform .18s var(--ease), box-shadow .18s var(--ease), filter .18s var(--ease);
      z-index:11;
      touch-action: manipulation;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: var(--btn-shadow-hover); }
    .btn:active { transform: translateY(0); filter: brightness(.95); }

    /* ripple */
    .btn::after{
      content:""; position:absolute; inset:0; border-radius:inherit;
      transform: scale(0); opacity:0; background:rgba(255,255,255,.25);
      transition: transform .35s var(--ease), opacity .6s var(--ease);
      pointer-events:none;
    }
    .btn.rippling::after{ transform: scale(1); opacity:1; }

    /* modal overlay */
    #proposal-modal {
      position:fixed; inset:0;
      background:rgba(0,0,0,0.88);
      display:flex; align-items:center; justify-content:center;
      opacity:0; visibility:hidden;
      transition:opacity .4s var(--ease), visibility .4s var(--ease);
      z-index:30;
    }
    #proposal-modal.show {
      opacity:1; visibility:visible;
    }

    /* modal content */
    .modal-content {
      position:relative;
      overflow:hidden;
      background:linear-gradient(45deg,rgba(147,43,226,0.7),rgba(226,43,147,0.7));
      background-size:200% 200%;
      animation:modalGradient 5s ease infinite, popIn .32s var(--ease);
      padding:20px;
      border-radius:14px;
      max-width:85%;
      text-align:center;
      z-index:31;
      box-shadow:0 0 30px rgba(147,51,234,0.9),0 0 60px rgba(226,43,147,0.7);
    }
    .modal-content h2 { line-height:1.35; }
    .modal-actions { display:flex; gap:12px; justify-content:center; margin-top:12px; }

    @keyframes modalGradient {
      0%  { background-position:0% 50%; }
      50% { background-position:100% 50%; }
      100%{ background-position:0% 50%; }
    }
    @keyframes popIn {
      0%   { transform:scale(.9); opacity:0; }
      100% { transform:scale(1); opacity:1; }
    }

    /* footer */
    footer {
      position:absolute; bottom:5px; width:100%;
      text-align:center; font-size:10px; color:#aaa; z-index:9;
      text-shadow: 0 1px 2px rgba(0,0,0,.6);
    }
    footer a { color:#b388ff; text-decoration:none; }

    /* motion preferences */
    @media (prefers-reduced-motion: reduce){
      .panel, .btn, #proposal-modal, .modal-content{ transition:none !important; animation:none !important; }
      .petal{ animation:none !important; }
      .btn::after{ display:none !important; }
    }
  </style>
</head>
<body>
  <!-- background audio -->
  <audio id="bg-music" src="assets/musica.mp3" loop></audio>

  <!-- petals always visible (mantido) -->
  <div class="petal-bg" aria-hidden="true"></div>
  <div class="petal-fg" aria-hidden="true"></div>

  <!-- fixed branches -->
  <img src="assets/branch-left.png" class="branch left" alt="" aria-hidden="true" />
  <img src="assets/branch-right.png" class="branch right" alt="" aria-hidden="true" />

  <div id="container" tabindex="-1">
    <section class="snap" id="part1"><div class="panel"><p>‚Äú√Äs vezes, o destino nos chama para caminhos inesperados‚Ä¶‚Äù</p></div></section>
    <section class="snap" id="part2"><div class="panel"><p>Voc√™ j√° parou para pensar em como cada encontro muda o rumo da nossa vida?</p></div></section>
    <section class="snap" id="part3"><div class="panel"><p>Alguns segredos est√£o reservados apenas para almas que ousam descobrir‚Ä¶</p><button id="btn3" class="btn">Toque para continuar</button></div></section>
    <section class="snap" id="part4"><div class="panel"><p>A jornada mais linda da vida‚Ä¶ come√ßa com um passo inesperado.</p></div></section>
    <section class="snap" id="part5"><div class="panel"><p>Entre todos os universos poss√≠veis‚Ä¶ que sorte a minha viver este ao seu lado.</p></div></section>
    <section class="snap" id="part6"><div class="panel"><p>Se voc√™ sentiu algo especial at√© aqui‚Ä¶ talvez haja mais esperando</p><button id="portalBtn" class="btn">Descobrir o segredo ‚Üí</button></div></section>

    <section class="snap nostalgia1">
      <div class="panel">
        <img src="assets/memoria1.jpg" alt="Momento especial 1" style="width:100%;border-radius:8px;margin-bottom:12px;"/>
        <p>Cada lembran√ßa, um cap√≠tulo do nosso livro.</p>
      </div>
    </section>

    <section class="snap nostalgia2">
      <div class="panel">
        <img src="assets/memoria2.jpg" alt="Momento especial 2" style="width:100%;border-radius:8px;margin-bottom:12px;"/>
        <p>Cada sorriso, cada gesto‚Ä¶ guardados para sempre.</p>
      </div>
    </section>

    <section class="snap nostalgia3">
      <div class="panel">
        <p>Agora, s√≥ falta uma pergunta ser respondida.</p>
        <button id="open-modal" class="btn">Clique para descobrir</button>
      </div>
    </section>
  </div>

  <!-- proposal modal -->
  <div id="proposal-modal" role="dialog" aria-modal="true" aria-labelledby="proposal-title" aria-hidden="true">
    <div class="modal-content">
      <h2 id="proposal-title">Carolina Mariko, voc√™ aceita casar comigo? üíç</h2>
      <div class="modal-actions">
        <button id="btn-yes" class="btn">Sim</button>
        <button id="btn-no"  class="btn">N√£o</button>
      </div>
    </div>
  </div>

  <footer>
    Music by
    <a href="https://pixabay.com/users/backgroundmusicforvideos-46459014/?utm_source=link-attribution&utm_medium=referral&utm_campaign=music&utm_content=338664">Maksym Malko</a>
    from
    <a href="https://pixabay.com/music//?utm_source=link-attribution&utm_medium=referral&utm_campaign=music&utm_content=338664">Pixabay</a>
  </footer>

  <script>
    // ===== Util =====
    const qs  = (s, el=document) => el.querySelector(s);
    const qsa = (s, el=document) => [...el.querySelectorAll(s)];
    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

    // ===== Microintera√ß√µes nos bot√µes (ripple) =====
    const addRipple = (btn) => {
      btn.addEventListener('pointerdown', () => {
        btn.classList.add('rippling');
        setTimeout(() => btn.classList.remove('rippling'), 300);
      });
    };
    qsa('.btn').forEach(addRipple);

    // ===== Panels: reveal com IntersectionObserver (stagger) =====
    const io = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const els = qsa('.panel', entry.target);
          if (els.length) {
            els.forEach((el, i) => {
              setTimeout(() => el.classList.add('in'), i * 80);
            });
          } else {
            entry.target.classList.add('in');
          }
          io.unobserve(entry.target);
        }
      });
    }, { root: qs('#container'), threshold: .35 });

    qsa('section.snap').forEach(sec => io.observe(sec));

    // ===== Parallax nos galhos =====
    const branchL = qs('.branch.left');
    const branchR = qs('.branch.right');
    let lastY = 0;

    const parallax = () => {
      const y = qs('#container').scrollTop;
      // damping
      lastY += (y - lastY) * 0.12;
      // movimentos opostos, sutis
      if (branchL) branchL.style.transform = `translate3d(${Math.sin(lastY*0.002)*6}px, ${lastY*0.05}px, 0)`;
      if (branchR) branchR.style.transform = `translate3d(${Math.sin(lastY*0.0018)*-6}px, ${-lastY*0.04}px, 0)`;
      requestAnimationFrame(parallax);
    };
    requestAnimationFrame(parallax);

    // ===== Sistema de p√©talas (fundo) ‚Äî preservado e otimizado =====
    const bgLayer = qs('.petal-bg');
    const fgLayer = qs('.petal-fg');
    const MAX_BG = 28;  // limite pra evitar excesso
    const MAX_FG = 18;

    const spawnPetal = (layer, size, duration) => {
      const p = document.createElement('img');
      p.src = 'assets/petal.png'; p.className = 'petal';
      p.alt = ''; p.setAttribute('aria-hidden', 'true');
      p.style.width = size+'px';
      p.style.left = Math.random()*100+'vw';
      p.style.top = '-15vh';
      p.style.animation = `fall ${duration}s linear forwards`;
      layer.append(p);
      setTimeout(()=>p.remove(), duration*1000);
    };

    setInterval(() => {
      if (bgLayer.children.length < MAX_BG) spawnPetal(bgLayer, 18 + Math.random()*10, 8 + Math.random()*4);
    }, 450);

    setInterval(() => {
      if (fgLayer.children.length < MAX_FG) spawnPetal(fgLayer, 32 + Math.random()*16, 5 + Math.random()*3);
    }, 900);

    // ===== Bot√µes de navega√ß√£o suave =====
    const container = qs('#container');
    qs('#btn3').addEventListener('click', () => {
      container.scrollTo({ top: window.innerHeight*3, behavior: 'smooth' });
    });

    // ===== Efeito portal otimizado (burst controlado) =====
    qs('#portalBtn').addEventListener('click', () => {
      const burst = 120; // menos DOM churn
      let i = 0;
      const tick = () => {
        const p = document.createElement('img');
        p.src = 'assets/petal.png'; p.className = 'petal';
        p.alt=''; p.setAttribute('aria-hidden','true');
        p.style.position='fixed';
        p.style.top=Math.random()*100+'vh';
        p.style.left=Math.random()*100+'vw';
        p.style.width=(10+Math.random()*28)+'px';
        p.style.zIndex=20;
        p.style.animation='fall 2s linear forwards';
        document.body.append(p);
        setTimeout(()=>p.remove(),2000);
        i++; if (i < burst) requestIdleCallback ? requestIdleCallback(tick) : setTimeout(tick, 8);
      };
      tick();
      setTimeout(()=>container.scrollTo({ top: window.innerHeight*6, behavior: 'smooth' }), 400);
    });

    // ===== Modal acess√≠vel =====
    const modal = qs('#proposal-modal');
    const openBtn = qs('#open-modal');
    const yesBtn = qs('#btn-yes');
    const noBtn  = qs('#btn-no');
    let lastFocus = null;

    const trapFocus = (e) => {
      const focusables = qsa('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])', modal)
        .filter(el => !el.hasAttribute('disabled'));
      if (!focusables.length) return;
      const first = focusables[0], last = focusables[focusables.length-1];
      if (e.key === 'Tab'){
        if (e.shiftKey && document.activeElement === first) { last.focus(); e.preventDefault(); }
        else if (!e.shiftKey && document.activeElement === last) { first.focus(); e.preventDefault(); }
      }
      if (e.key === 'Escape') closeModal();
    };

    const openModal = () => {
      lastFocus = document.activeElement;
      modal.classList.add('show');
      modal.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      yesBtn.focus();

      // p√©talas internas elegantes
      const rect = qs('.modal-content').getBoundingClientRect();
      let k = 0, total = 120;
      const spawn = () => {
        const p = document.createElement('img'); p.src='assets/petal.png'; p.className='petal';
        p.alt=''; p.setAttribute('aria-hidden','true');
        p.style.position='fixed';
        p.style.top = rect.bottom+'px';
        p.style.left = (rect.left + Math.random()*rect.width)+'px';
        p.style.width = (10 + Math.random()*20)+'px';
        p.style.zIndex = 31;
        p.style.animation='rise .8s ease-out forwards, fall 2.2s linear .8s forwards';
        document.body.append(p);
        setTimeout(()=>p.remove(), 3000);
        k++; if (k<total) setTimeout(spawn, 10 + Math.random()*30);
      };
      spawn();

      modal.addEventListener('keydown', trapFocus);
    };

    const closeModal = () => {
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
      modal.removeEventListener('keydown', trapFocus);
      if (lastFocus) lastFocus.focus();
    };

    openBtn.addEventListener('click', openModal);
    modal.addEventListener('click', (e)=>{ if (e.target === modal) closeModal(); });

    yesBtn.addEventListener('click', () => {
      alert('üíñ Ela disse SIM! üíñ');
      closeModal();
    });
    noBtn.addEventListener('click', () => {
      alert('üòâ Talvez ela precise de um tempinho.');
      closeModal();
    });

    // ===== √Åudio: desbloqueio em toque =====
    const audio = qs('#bg-music');
    const tryPlay = () => audio.play().catch(()=>{ /* ignorar */ });
    window.addEventListener('load', () => {
      audio.volume = 0.3;
      tryPlay();
      const unlock = () => { tryPlay(); document.removeEventListener('pointerdown', unlock, { once:true }); };
      document.addEventListener('pointerdown', unlock, { once:true });
    });

    // ===== Acessibilidade extra em iOS/Android =====
    // Ao abrir modal, evitar "salto" do scroll do container
    const lockScrollOnModal = () => {
      if (modal.classList.contains('show')) container.style.overflowY = 'hidden';
      else container.style.overflowY = 'auto';
      requestAnimationFrame(lockScrollOnModal);
    };
    requestAnimationFrame(lockScrollOnModal);
  </script>
</body>
</html>